# RepoGPT API Documentation ðŸ“š

## Backend Endpoints (FastAPI)

### 1. Repository Ingestion
`POST /api/repo/ingest`
- **Request Body**: `IngestRequest` (repoUrl, userId)
- **Description**: Triggers the background ingestion process (Cloning -> AST Chunking -> LLM Summarization -> Embedding).
- **Table**: `repositories`

### 2. Codebase Chat (RAG)
`POST /api/chat/stream`
- **Request Body**: `RepoChatRequest` (repoId, query, sessionId)
- **Response**: Server-Sent Events (SSE) stream.
- **Protocol**:
    - `type: status`: Current RAG stage (retrieving, reranking, etc.)
    - `type: metadata`: Contextual files found.
    - `type: token`: Text generated by Gemini 2.0 Flash.
    - `data: [DONE]`: Stream completion.

### 3. Researcher / Analyst Mode
`POST /api/chat/analyze`
- **Request Body**: `AnalystRequest` (userId, query, sessionId)
- **Description**: Orchestrates a multi-agent workflow to research external repositories and technical patterns.
- **Agents Involved**: `Planner`, `Research`, `Writer`, `Editor`, `Critique`.

---

## Agentic Protocol

RepoGPT uses a specialized agentic workflow for high-precision technical research:

1. **Planning**: The `Planner` agent breaks the user query into 4-6 technical sub-tasks.
2. **Execution**: The `Research` agent uses tools (`tavily`, `github_search`, `arxiv`) to gather data.
3. **Self-Correction**: A `Critique` agent validates the research findings. If found inadequate, the system retries the step with enhanced context.
4. **Synthesis**: `Writer` and `Editor` agents collaborate to produce the final "Project Blueprint".

---

## Database Schema (Supabase)

- `repositories`: Metadata and file tree.
- `file_summaries`: LLM-generated high-level descriptions for each file.
- `code_chunks`: AST-aligned code blocks with vector embeddings.
- `file_dependencies`: Extracted static dependencies for graph-based navigation (Phase 2).
- `messages`: Persistent chat history for conversational memory.
